<html>
<head>
	<title>Light the darkness!</title>
	<style type="text/css">
		#main {
			position: relative;
			margin-left: auto;
    	margin-right: auto;
    	width: 6em;
		}
		#timer {
			width: 175px;
			height: 20px;
			border: solid;
			position: relative;
			text-align: center;
			font-family: tahoma;
		}

		#game {
			width: 175px;
			height: 175px;
			border: solid black;
			position: relative;
			display: inline-block;
			font-family: tahoma;
		}
		#rules {
/*			border: solid black;*/
			position: relative;
			padding: 10px;
			font-family: tahoma;
		}
		#rules h4{
			font-size: 12px;
			font-weight: normal;
		}
		#done{
			border: black solid;
			text-align: center;
			width: 175px;
			position: relative;
			font-family: tahoma;
			cursor: pointer;
		}
		#done h3 {
			font-weight: normal;
		}
	</style>
</head>
<body>
	<div id="main">
		<div id="timer">00:00</div>
		<div id="game"></div>
		<div id="done"><h3>DONE</h3></div>
	</div>
	<div id="rules">
		<h4>Light the darkness! is played on a rectangular grid. The grid has both black cells and white cells in it. The objective is to place light bulbs on the grid so that every white square is lit. A cell is illuminated by a light bulb if they're in the same row or column, and if there are no black cells between them. Also, no light bulb may illuminate another light bulb. 
Some of the black cells have numbers in them. A number in a black cell indicates how many light bulbs share an edge with that cell. 
Left click a square to place a light bulb.</h4>
	</div>
	


	<script type="text/javascript">
	map = [[{"type":0, "attr":0}, {"type":0, "attr":0}, {"type":1, "attr":2}, {"type":1, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}], 
				 [{"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":1, "attr":3}, {"type":0, "attr":0}, {"type":0, "attr":0}], 
				 [{"type":0, "attr":0}, {"type":1, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":1, "attr":0}], 
				 [{"type":1, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":1, "attr":0}],
				 [{"type":1, "attr":2}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":1, "attr":0}, {"type":0, "attr":0}], 
				 [{"type":0, "attr":0}, {"type":0, "attr":0}, {"type":1, "attr":2}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}],
				 [{"type":0, "attr":0}, {"type":0, "attr":0}, {"type":0, "attr":0}, {"type":1, "attr":0}, {"type":1, "attr":1}, {"type":0, "attr":0}, {"type":0, "attr":0}]] 
				 //type: 0-empty \ 1-block \ 2-bulb //attr0: 0|1 //attr1: number //attr2: 0|1 (not or red)
	game = document.getElementById("game")


	render = function() {
		while (game.firstChild) game.removeChild(game.firstChild); // clean all
		for(i=0; i<7; i++){
			for(j=0; j<7; j++){
				t = i*25;
				l = j*25
				d = document.createElement("div")
				type = map[i][j].type
				attr = map[i][j].attr
				symbol = ""
				if(type == 1) {color = "black", symbol=(attr!=0)?attr:""} //block
					else if(type == 0){ //empty
						if(attr == 1) color = "yellow"
						else color = "white"
					}	else {						//bulb
							if(attr == 0) symbol = "ðŸ’¡" //ðŸ’¡
							else symbol = "ðŸ”´"
							color = "yellow"
						}
				d.setAttribute("style", "cursor:default; position:absolute; text-align:center; font-weight:bold; font-size:20px; color:white;  background:"+color+"; border: 1px solid black; width:25px; height:25px; top:"+t+"px; left:"+l+"px");
				d.setAttribute("class", type != 1 ? "empty" : "block")
				d.setAttribute("id", i+":"+j)
				d.innerHTML = symbol
				game.appendChild(d) 
			}
		}
		emptys = document.getElementsByClassName('empty')
		for(i=0; i<emptys.length; i++) {
		emptys[i].addEventListener('click', function (event) {
		            //console.log(event.srcElement.id)
		            putBulb(event.srcElement.id.split(":"))
		        });
		}
	}
	render();

	function putBulb(coord) {
		i = parseInt(coord[0]); j = parseInt(coord[1]);
		type = map[i][j].type
		if(type == 0) { //set bulb
			map[i][j].type = 3
			map[i][j].attr = 0
		} 
		else { // no bulb
			map[i][j].type = 0 
			map[i][j].attr = 0
			k = 1
			while(i+k<7 && map[i+k][j].type != 1){ //down
				if(map[i+k][j].type == 3) map[i+k][j].attr = 0
				k++; 
			}
			k = 1
			while(i-k >=0 && map[i-k][j].type != 1){ //up
				if(map[i-k][j].type == 3) map[i-k][j].attr = 0
				k++; 
			}
			k = 1
			while(j+k<7 && map[i][j+k].type != 1){ //right
				if(map[i][j+k].type == 3) map[i][j+k].attr = 0
				k++; 
			}
			k = 1
			while(j-k >=0 && map[i][j-k].type != 1){ //left
				if(map[i][j-k].type == 3) map[i][j-k].attr = 0
				k++; 
			}
		}
		
		//cleaning all the light
		for(i=0; i<7; i++) {
			for(j=0; j<7; j++) {
				if(map[i][j].type == 0) map[i][j].attr = 0
			}
		}

		for(i=0; i<7; i++) {
			for(j=0; j<7; j++) {
				if(map[i][j].type == 3) {
					k = 1
					while(i+k<7 && map[i+k][j].type != 1){ //down
						if(map[i+k][j].type == 0) map[i+k][j].attr = 1
						else if(map[i+k][j].type == 3) {
							map[i+k][j].attr = 1;
							map[i][j].attr = 1;
						}
						k++;
					}
					k = 1
					while(i-k >=0 && map[i-k][j].type != 1){ //up
						if(map[i-k][j].type == 0) map[i-k][j].attr = 1
						else if(map[i-k][j].type == 3) {
							map[i-k][j].attr = 1;
							map[i][j].attr = 1;
						}
						k++;
					}

					k = 1
					while(j+k<7 && map[i][j+k].type != 1){ //right
						if(map[i][j+k].type == 0) map[i][j+k].attr = 1
						else if(map[i][j+k].type == 3) {
							map[i][j+k].attr = 1;
							map[i][j].attr = 1;
						}
						k++;
					}
					k = 1
					while(j-k >=0 && map[i][j-k].type != 1){ //left
						if(map[i][j-k].type == 0) map[i][j-k].attr = 1
						else if(map[i][j-k].type == 3) {
							map[i][j-k].attr = 1;
							map[i][j].attr = 1;
						}
						k++;
					}

				}
			}
		}
		render();
	}



	checkGame = function() {
		checkArr = [[], [], [], [], [], [], []]
		s = 0;
		for(i=0; i<7; i++) {
			for(j=0; j<7; j++) {
				t = s;
				if(map[i][j].type == 0 && map[i][j].attr == 1) s++; // lighted cell
				else if(map[i][j].type == 3 && map[i][j].attr == 0) s++ // bulb
				else if(map[i][j].type == 1 && map[i][j].attr > 0) { // block
					numOfBulbsAround = 0
					if(j+1<7 && map[i][j+1].type == 3) numOfBulbsAround++;
					if(j-1>=0 && map[i][j-1].type == 3) numOfBulbsAround++;
					if(i+1<7 && map[i+1][j].type == 3) numOfBulbsAround++;
					if(i-1>=0 && map[i-1][j].type == 3) numOfBulbsAround++;
					if(numOfBulbsAround == map[i][j].attr) s++; 
				}
				else if(map[i][j].type == 1 && map[i][j].attr == 0) s++; 
				checkArr[i].push(s-t)
			}
		}
		console.log(s)
		console.log(checkArr)
		console.log(map)
		if(s == 49) {
			clearInterval(refreshIntervalId);
			alert("well done!")
		}
		//else alert("not yet")
	}

	document.getElementById("done").addEventListener('click', function (event) {
		checkGame()
	})

	function startTimer() {
		timer = document.getElementById("timer")
		var totalSeconds = 0;
		refreshIntervalId = setInterval(setTime, 1000);

		function setTime() {
		  ++totalSeconds;
		  sec = pad(totalSeconds % 60);
		  min = pad(parseInt(totalSeconds / 60));
		  timer.innerHTML = min + ":" + sec;
		}

		function pad(val) {
		  var valString = val + "";
		  if (valString.length < 2) {
		    return "0" + valString;
		  } else {
		    return valString;
		  }
		}
	}
	startTimer();

	</script>

</body>
</html>